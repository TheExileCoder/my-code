# 网络综合

## 1.距离向量算法的水平分割

原理：路由器从某个接口接收到的更新信息不允许再从这个接口发送回去。

优点：1. 阻止路由环路产生；2. 减少路由器更新信息占用的链路带宽资源。

环路产生的原因：A路由器将自己从B路由器学到的路由信息又传给B，导致数据在AB路由器间不断循环传递直至超出TTL。

## 2.HUB（集线器）

```
HUB通常也叫集线器，一般可以作为地址翻译设备
```

错误，地址翻译是网络层的功能。

## 3.分组交换

为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块，称之为分组( packet) 。

### 3.1存储转发传输

存储转发机制是指在交换机能够开始向输出链路传输该分组的第一个比特之前，必须接受到整个分组。

### 3.2排队延迟和分组丢失

每个分组交换机有多条链路与之相连 。 对于每条相连的链路，该分组交换机具有一个输出缓存 (output buffer) (也称为输出队列 output queue) ，它用于存储路由器准备发往那条链路的分组 。 该输出缓存在分组交换中起着重要的作用。如果到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，该到达分组必须该输出缓存中等待。因此，除了存储转发时延以外，分组还要承受输出缓存的排队时延 (queue delay) 。 这些时延是变化的，变化的程度取决于网络中的拥塞程度 。 因为缓存空间的大小是有限的， 一个到达的分组可能发现该缓存已被其他等待传输的分组完全充满了 。 在此情况下，将出现分组丢失(丢包) (packet  lost) ，到达的分组或已经排队的分组之一将被丢弃。

### 3.3转发表和路由选择协议

在因特网中，每个端系统具有一个称为IP地址的地址。 当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。如同邮政地址那样，该地址具有一种等级结构。当一个分组到达网络中的路由器时，路由器检查该分组的目的地址的一部分，并向一台相邻路由器转发该分组。更特别的是，每台路由器具有一个转发表(forwarding  table)，用于将目的地址(或目的地址的一部分)映射成为输出链路。当某分组到达一台路由器时，路由器检查该地址，并用这个目的地址搜索其转发表，以发现适当的出链路。路由器则将分组导向该出链路 。

## 4.TCP

![image-20220108142431416](C:\Users\victor\AppData\Roaming\Typora\typora-user-images\image-20220108142431416.png)

![这里写图片描述](https://img-blog.csdn.net/20170823193112679?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzYxNjk0NQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

## 4.1 TIME_WAIT

### 4.1.1 time_wait状态如何产生？ 

由上面的变迁图，首先调用close()发起主动关闭的一方，在发送最后一个ACK之后会进入time_wait的状态，也就说该发送方会保持2MSL时间之后才会回到初始状态。MSL指得是数据包在网络中的最大生存时间。产生这种结果使得这个TCP连接在2MSL连接等待期间，定义这个连接的四元组（客户端IP地址和端口，服务端IP地址和端口号）不能被使用。

### 4.1.2 time_wait状态产生的原因

1）为实现TCP全双工连接的可靠释放

由TCP状态变迁图可知，假设发起主动关闭的一方（client）最后发送的ACK在网络中丢失，由于TCP协议的重传机制，执行被动关闭的一方（server）将会重发其FIN，在该FIN到达client之前，client必须维护这条连接状态，也就说这条TCP连接所对应的资源（client方的local_ip,local_port）不能被立即释放或重新分配，直到另一方重发的FIN达到之后，client重发ACK后，经过2MSL时间周期没有再收到另一方的FIN之后，该TCP连接才能恢复初始的CLOSED状态。如果主动关闭一方不维护这样一个TIME_WAIT状态，那么当被动关闭一方重发的FIN到达时，主动关闭一方的TCP传输层会用RST包响应对方，这会被对方认为是有错误发生，然而这事实上只是正常的关闭连接过程，并非异常。

 2）为使旧的数据包在网络因过期而消失

为说明这个问题，我们先假设TCP协议中不存在TIME_WAIT状态的限制，再假设当前有一条TCP连接：(local_ip, local_port, remote_ip,remote_port)，因某些原因，我们先关闭，接着很快以相同的四元组建立一条新连接。本文前面介绍过，TCP连接由四元组唯一标识，因此，在我们假设的情况中，TCP协议栈是无法区分前后两条TCP连接的不同的，在它看来，这根本就是同一条连接，中间先释放再建立的过程对其来说是“感知”不到的。这样就可能发生这样的情况：前一条TCP连接由local peer发送的数据到达remote peer后，会被该remote peer的TCP传输层当做当前TCP连接的正常数据接收并向上传递至应用层（而事实上，在我们假设的场景下，这些旧数据到达remote peer前，旧连接已断开且一条由相同四元组构成的新TCP连接已建立，因此，这些旧数据是不应该被向上传递至应用层的），从而引起数据错乱进而导致各种无法预知的诡异现象。作为一种可靠的传输协议，TCP必须在协议层面考虑并避免这种情况的发生，这正是TIME_WAIT状态存在的第2个原因。

### 4.1.3 time_wait状态如何避免

首先服务器可以设置SO_REUSEADDR套接字选项来通知内核，如果端口忙，但TCP连接位于TIME_WAIT状态时可以重用端口。在一个非常有用的场景就是，如果你的服务器程序停止后想立即重启，而新的套接字依旧希望使用同一端口，此时SO_REUSEADDR选项就可以避免TIME_WAIT状态。

## 5.HTTPS

在HTTP跟TCP中间多了一层加密层TLS/SSL就是HTTPS。TLS是SSL的升级版。

## 6. IPV6

IPV6 地址类型可分为单播地址、组播地址和任播地址。

为了便于从 IPV4 迁移到 IPV6，IPV6 定义了以下兼容地址；IPV4 兼容地址，IPV4 映射地址和 6to4 地址

FB80:0:0:0:2AA:FF:FE9A:4CAE 可缩写为 FE80::2AA:FF:FE9A:4CAE

目的地址是链路本地地址或站点本地地址的报文，路由器不会对其进行转发

## 7. 中继器

中继器（RP repeater）是工作在物理层上的连接设备。适用于**完全相同**的两类网络的互连，主要功能是通过对数据信号的重新发送或者转发，来扩大网络传输的距离。

## 8.因特网中的路由选择

BGP采用的是路径向量路由选择协议。 OSPF是链路状态路由算法的代表，使用的是洪泛法。 RIP是一种分布式的基于距离向量的路由选择算法。
